(function(e){var u;var m;var k;var B;var t;var o=window;if(!Object.keys){Object.keys=(function(){var y=Object.prototype.hasOwnProperty,C=!({toString:null}).propertyIsEnumerable("toString"),x=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],i=x.length;return function(F){if(typeof F!=="object"&&(typeof F!=="function"||F===null)){throw new TypeError("Object.keys called on non-object")}var D=[],G,E;for(G in F){if(y.call(F,G)){D.push(G)}}if(C){for(E=0;E<i;++E){if(y.call(F,x[E])){D.push(x[E])}}}return D}}())}var c=false;var f=200;var p=(location.hash==="#debug");function d(i){if(p){console.log(i)}}var r=["Days","Hours","Minutes","Seconds"];var v={Seconds:"Minutes",Minutes:"Hours",Hours:"Days",Days:"Years"};var w={Seconds:1,Minutes:60,Hours:3600,Days:86400,Months:2678400,Years:31536000};function z(y){var x=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;y=y.replace(x,function(D,F,E,C){return F+F+E+E+C+C});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(y);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}function g(){var i=document.createElement("canvas");return !!(i.getContext&&i.getContext("2d"))}function b(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function q(){return b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(x){var i=this.length>>>0;var y=Number(arguments[1])||0;y=(y<0)?Math.ceil(y):Math.floor(y);if(y<0){y+=i}for(;y<i;y++){if(y in this&&this[y]===x){return y}}return -1}}function h(E){var x=E.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}\s[0-9]{1,2}:[0-9]{2}:[0-9]{2}$/);if(x!==null&&x.length>0){var C=E.split(" ");var i=C[0].split("-");var y=C[1].split(":");return new Date(i[0],i[1]-1,i[2],y[0],y[1],y[2])}var D=Date.parse(E);if(!isNaN(D)){return D}D=Date.parse(E.replace(/-/g,"/").replace("T"," "));if(!isNaN(D)){return D}return new Date()}function l(M,O,J,F,E){var H={};var G={};var x={};var N={};var I={};var D={};var C=null;for(u=0;u<F.length;++u){var L=F[u];var y;if(C===null){y=J/w[L]}else{y=w[C]/w[L]}var i=(M/w[L]);var K=(O/w[L]);if(E){if(i>0){i=Math.floor(i)}else{i=Math.ceil(i)}if(K>0){K=Math.floor(K)}else{K=Math.ceil(K)}}if(L!=="Days"){i=i%y;K=K%y}H[L]=i;x[L]=Math.abs(i);G[L]=K;D[L]=Math.abs(K);N[L]=Math.abs(i)/y;I[L]=Math.abs(K)/y;C=L}return{raw_time:H,raw_old_time:G,time:x,old_time:D,pct:N,old_pct:I}}var s={};function n(){if(typeof o.TC_Instance_List!=="undefined"){s=o.TC_Instance_List}else{o.TC_Instance_List=s}a(o)}function a(i){var x=["webkit","moz"];for(m=0;m<x.length&&!i.requestAnimationFrame;++m){i.requestAnimationFrame=i[x[m]+"RequestAnimationFrame"];i.cancelAnimationFrame=i[x[m]+"CancelAnimationFrame"]}if(!i.requestAnimationFrame||!i.cancelAnimationFrame){i.requestAnimationFrame=function(G,D,y){if(typeof y==="undefined"){y={data:{last_frame:0}}}var C=new Date().getTime();var E=Math.max(0,16-(C-y.data.last_frame));var F=i.setTimeout(function(){G(C+E)},E);y.data.last_frame=C+E;return F};i.cancelAnimationFrame=function(y){clearTimeout(y)}}}var j=function(x,i){this.element=x;this.listeners=null;this.data={paused:false,last_frame:0,animation_frame:null,interval_fallback:null,timer:false,total_duration:null,prev_time:null,drawn_units:[],text_elements:{Days:null,Hours:null,Minutes:null,Seconds:null},attributes:{canvas:null,context:null,item_size:null,line_width:null,radius:null,outer_radius:null},state:{fading:{Days:false,Hours:false,Minutes:false,Seconds:false}}};this.config=null;this.setOptions(i);this.initialize()};j.prototype.clearListeners=function(){this.listeners={all:[],visible:[]}};j.prototype.addTime=function(i){if(this.data.attributes.ref_date instanceof Date){var x=this.data.attributes.ref_date;x.setSeconds(x.getSeconds()+i)}else{if(!isNaN(this.data.attributes.ref_date)){this.data.attributes.ref_date+=(i*1000)}}};j.prototype.initialize=function(F){this.data.drawn_units=[];for(u=0;u<Object.keys(this.config.time).length;++u){var H=Object.keys(this.config.time)[u];if(this.config.time[H].show){this.data.drawn_units.push(H)}}e(this.element).children("div.time_circles").remove();if(typeof F==="undefined"){F=true}if(F||this.listeners===null){this.clearListeners()}this.container=e("<div>");this.container.addClass("time_circles");this.container.appendTo(this.element);var I=this.element.offsetHeight;var i=this.element.offsetWidth;if(I===0){I=e(this.element).height()}if(i===0){i=e(this.element).width()}if(I===0&&i>0){I=i/this.data.drawn_units.length}else{if(i===0&&I>0){i=I*this.data.drawn_units.length}}var G=document.createElement("canvas");G.width=i;G.height=I;this.data.attributes.canvas=e(G);this.data.attributes.canvas.appendTo(this.container);var E=g();if(!E&&typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(G);c=true;E=true}if(E){this.data.attributes.context=G.getContext("2d")}this.data.attributes.item_size=Math.min(i/this.data.drawn_units.length,I);this.data.attributes.line_width=this.data.attributes.item_size*this.config.fg_width;this.data.attributes.radius=((this.data.attributes.item_size*0.8)-this.data.attributes.line_width)/2;this.data.attributes.outer_radius=this.data.attributes.radius+0.5*Math.max(this.data.attributes.line_width,this.data.attributes.line_width*this.config.bg_width);u=0;for(B in this.data.text_elements){if(!this.config.time[B].show){continue}var x=e("<div>");x.addClass("textDiv_"+B);x.css("top",Math.round(0.35*this.data.attributes.item_size));x.css("left",Math.round(++u*this.data.attributes.item_size));x.css("width",this.data.attributes.item_size);x.appendTo(this.container);var C=e("<h4>");C.text(this.config.time[B].text);C.css("font-size",Math.round(this.config.text_size*this.data.attributes.item_size));C.css("line-height",Math.round(this.config.text_size*this.data.attributes.item_size)+"px");C.appendTo(x);var y=e("<span>");y.css("font-size",Math.round(3*this.config.text_size*this.data.attributes.item_size));y.css("line-height",Math.round(this.config.text_size*this.data.attributes.item_size)+"px");y.appendTo(x);this.data.text_elements[B]=y}this.start();if(!this.config.start){this.data.paused=true}var D=this;this.data.interval_fallback=o.setInterval(function(){D.update(true)},100)};j.prototype.update=function(L){if(typeof L==="undefined"){L=false}else{if(L&&this.data.paused){return}}if(c){this.data.attributes.context.clearRect(0,0,this.data.attributes.canvas[0].width,this.data.attributes.canvas[0].hright)}var J,M;var i=this.data.prev_time;var C=new Date();this.data.prev_time=C;if(i===null){i=C}if(!this.config.count_past_zero){if(C>this.data.attributes.ref_date){for(u=0;u<this.data.drawn_units.length;++u){B=this.data.drawn_units[u];this.data.text_elements[B].text("0");m=(u*this.data.attributes.item_size)+(this.data.attributes.item_size/2);k=this.data.attributes.item_size/2;t=this.config.time[B].color;this.drawArc(m,k,t,0)}this.stop();return}}J=(this.data.attributes.ref_date-C)/1000;M=(this.data.attributes.ref_date-i)/1000;var G=this.config.animation!=="smooth";var x=l(J,M,this.data.total_duration,this.data.drawn_units,G);var y=l(J,M,w.Years,r,G);u=0;var E=0;var K=null;var I=this.data.drawn_units.slice();for(u in r){if(!r.hasOwnProperty(u)){continue}B=r[u];if(Math.floor(y.raw_time[B])!==Math.floor(y.raw_old_time[B])){this.notifyListeners(B,Math.floor(y.time[B]),Math.floor(J),"all")}if(I.indexOf(B)<0){continue}if(Math.floor(x.raw_time[B])!==Math.floor(x.raw_old_time[B])){this.notifyListeners(B,Math.floor(x.time[B]),Math.floor(J),"visible")}if(!L){this.data.text_elements[B].text(Math.floor(Math.abs(x.time[B])));m=(E*this.data.attributes.item_size)+(this.data.attributes.item_size/2);k=this.data.attributes.item_size/2;t=this.config.time[B].color;if(this.config.animation==="smooth"){if(K!==null&&!c){if(Math.floor(x.time[K])>Math.floor(x.old_time[K])){this.radialFade(m,k,t,1,B);this.data.state.fading[B]=true}else{if(Math.floor(x.time[K])<Math.floor(x.old_time[K])){this.radialFade(m,k,t,0,B);this.data.state.fading[B]=true}}}if(!this.data.state.fading[B]){this.drawArc(m,k,t,x.pct[B])}}else{this.animateArc(m,k,t,x.pct[B],x.old_pct[B],(new Date()).getTime()+f)}}K=B;++E}if(this.data.paused||L){return}var H=this;var D=function(){H.update.call(H)};if(this.config.animation==="smooth"){this.data.animation_frame=o.requestAnimationFrame(D,H.element,H)}else{var F=(J%1)*1000;if(F<0){F=1000+F}F+=50;H.data.animation_frame=o.setTimeout(function(){H.data.animation_frame=o.requestAnimationFrame(D,H.element,H)},F)}};j.prototype.animateArc=function(I,G,D,C,H,F){if(this.data.attributes.context===null){return}var J=H-C;if(Math.abs(J)>0.5){if(C===0){this.radialFade(I,G,D,1)}else{this.radialFade(I,G,D,0)}}else{var i=(f-(F-(new Date()).getTime()))/f;if(i>1){i=1}var K=(H*(1-i))+(C*i);this.drawArc(I,G,D,K);if(i>=1){return}var E=this;o.requestAnimationFrame(function(){E.animateArc(I,G,D,C,H,F)},this.element)}};j.prototype.drawArc=function(I,H,C,J){if(this.data.attributes.context===null){return}var F=Math.max(this.data.attributes.outer_radius,this.data.attributes.item_size/2);if(!c){this.data.attributes.context.clearRect(I-F,H-F,F*2,F*2)}if(this.config.use_background){this.data.attributes.context.beginPath();this.data.attributes.context.arc(I,H,this.data.attributes.radius,0,2*Math.PI,false);this.data.attributes.context.lineWidth=this.data.attributes.line_width*this.config.bg_width;this.data.attributes.context.strokeStyle=this.config.circle_bg_color;this.data.attributes.context.stroke()}var G,i,K;var E=(-0.5*Math.PI);var L=2*Math.PI;G=E+(this.config.start_angle/360*L);var D=(2*J*Math.PI);if(this.config.direction==="Both"){K=false;G-=(D/2);i=G+D}else{if(this.config.direction==="Clockwise"){K=false;i=G+D}else{K=true;i=G-D}}this.data.attributes.context.beginPath();this.data.attributes.context.arc(I,H,this.data.attributes.radius,G,i,K);this.data.attributes.context.lineWidth=this.data.attributes.line_width;this.data.attributes.context.strokeStyle=C;this.data.attributes.context.stroke()};j.prototype.radialFade=function(i,I,C,H,E){var D=z(C);var G=this;var F=0.2*((H===1)?-1:1);for(u=0;H<=1&&H>=0;++u){(function(){var x=50*u;var y="rgba("+D.r+", "+D.g+", "+D.b+", "+(Math.round(H*10)/10)+")";o.setTimeout(function(){G.drawArc(i,I,y,1)},x)}());H+=F}if(typeof E!==undefined){o.setTimeout(function(){G.data.state.fading[E]=false},50*u)}};j.prototype.timeLeft=function(){if(this.data.paused&&typeof this.data.timer==="number"){return this.data.timer}var i=new Date();return((this.data.attributes.ref_date-i)/1000)};j.prototype.start=function(){o.cancelAnimationFrame(this.data.animation_frame);o.clearTimeout(this.data.animation_frame);var x=e(this.element).data("date");if(typeof x==="undefined"){x=e(this.element).attr("data-date")}if(typeof x==="string"){this.data.attributes.ref_date=h(x)}else{if(typeof this.data.timer==="number"){if(this.data.paused){this.data.attributes.ref_date=(new Date()).getTime()+(this.data.timer*1000)}}else{var i=e(this.element).data("timer");if(typeof i==="undefined"){i=e(this.element).attr("data-timer")}if(typeof i==="string"){i=parseFloat(i)}if(typeof i==="number"){this.data.timer=i;this.data.attributes.ref_date=(new Date()).getTime()+(i*1000)}else{this.data.attributes.ref_date=this.config.ref_date}}}this.data.paused=false;this.update()};j.prototype.restart=function(){this.data.timer=false;this.start()};j.prototype.stop=function(){if(typeof this.data.timer==="number"){this.data.timer=this.timeLeft(this)}this.data.paused=true;o.cancelAnimationFrame(this.data.animation_frame)};j.prototype.destroy=function(){this.clearListeners();this.stop();o.clearInterval(this.data.interval_fallback);this.data.interval_fallback=null;this.container.remove();e(this.element).removeAttr("data-tc-id");e(this.element).removeData("tc-id")};j.prototype.setOptions=function(i){if(this.config===null){this.default_options.ref_date=new Date();this.config=e.extend(true,{},this.default_options)}e.extend(true,this.config,i);if(this.config.use_top_frame){o=window.top}else{o=window}n();this.data.total_duration=this.config.total_duration;if(typeof this.data.total_duration==="string"){if(typeof w[this.data.total_duration]!=="undefined"){this.data.total_duration=w[this.data.total_duration]}else{if(this.data.total_duration==="Auto"){for(u=0;u<Object.keys(this.config.time).length;++u){var x=Object.keys(this.config.time)[u];if(this.config.time[x].show){this.data.total_duration=w[v[x]];break}}}else{this.data.total_duration=w.Years;console.error("Valid values for TimeCircles config.total_duration are either numeric, or (string) Years, Months, Days, Hours, Minutes, Auto")}}}};j.prototype.addListener=function(y,i,x){if(typeof y!=="function"){return}if(typeof x==="undefined"){x="visible"}this.listeners[x].push({func:y,scope:i})};j.prototype.notifyListeners=function(y,D,x,i){for(u=0;u<this.listeners[i].length;++u){var C=this.listeners[i][u];C.func.apply(C.scope,[y,D,x])}};j.prototype.default_options={ref_date:new Date(),start:true,animation:"smooth",count_past_zero:true,circle_bg_color:"#60686F",use_background:true,fg_width:0.1,bg_width:1.2,text_size:0.07,total_duration:"Auto",direction:"Clockwise",use_top_frame:false,start_angle:0,time:{Days:{show:true,text:"Days",color:"#FC6"},Hours:{show:true,text:"Hours",color:"#9CF"},Minutes:{show:true,text:"Minutes",color:"#BFB"},Seconds:{show:true,text:"Seconds",color:"#F99"}}};var A=function(x,i){this.elements=x;this.options=i;this.foreach()};A.prototype.getInstance=function(C){var i;var y=e(C).data("tc-id");if(typeof y==="undefined"){y=q();e(C).attr("data-tc-id",y)}if(typeof s[y]==="undefined"){var x=this.options;var D=e(C).data("options");if(typeof D==="string"){D=JSON.parse(D)}if(typeof D==="object"){x=e.extend(true,{},this.options,D)}i=new j(C,x);s[y]=i}else{i=s[y];if(typeof this.options!=="undefined"){i.setOptions(this.options)}}return i};A.prototype.addTime=function(i){this.foreach(function(x){x.addTime(i)})};A.prototype.foreach=function(x){var i=this;this.elements.each(function(){var y=i.getInstance(this);if(typeof x==="function"){return x(y)}});return this};A.prototype.start=function(){this.foreach(function(i){i.start()});return this};A.prototype.stop=function(){this.foreach(function(i){i.stop()});return this};A.prototype.restart=function(){this.foreach(function(i){i.restart()});return this};A.prototype.rebuild=function(){this.foreach(function(i){i.initialize(false)});return this};A.prototype.getTime=function(){return this.getInstance(this.elements[0]).timeLeft()};A.prototype.addListener=function(x,i){if(typeof i==="undefined"){i="visible"}var y=this;this.foreach(function(C){C.addListener(x,y.elements,i)});return this};A.prototype.destroy=function(){this.foreach(function(i){i.destroy()});return this};A.prototype.end=function(){return this.elements};e.fn.TimeCircles=function(i){return new A(this,i)}}(jQuery));