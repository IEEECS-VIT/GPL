<!--
  GraVITas Premier League <gravitaspremierleague@gmail.com>
  Copyright (C) 2014  IEEE Computer Society - VIT Student Chapter <ieeecs@vit.ac.in>

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<!doctype html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- build:css(.) styles/vendor.css -->
    <!-- bower:css -->
    <!-- endbower -->
    <!-- endbuild -->
    <!-- build:css(.tmp) styles/main.css -->
    <!--<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>-->
    <link type="text/css" rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/stylesheets/main.css"/>
    <link rel="stylesheet" href="/stylesheets/playerselect.css"/>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                        (i[r].q = i[r].q || []).push(arguments)
                    }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-57505316-2', 'auto');
        ga('send', 'pageview');

    </script>
    <!-- endbuild -->
</head>
<body ng-app="formApp">
<!--[if lt IE 7]>
<p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> to improve your experience.</p>
<![endif]-->

<div id="gplheader" class="page-title hidden-xs hidden-sm hidden-md">
    <header class="banner" role="banner">

        <span><img src="/images/header-left.jpg" height="60" class="pull-left"/><img class="logo pull-left"
                                                                                     src="/images/gpllogo.png"
                                                                                     height="50"/><span
                    class="h2 gplheadertext">graVITas Premier League 2.0</span><img src="/images/header-right.jpg"
                                                                                    height="60"
                                                                                    class="pull-right"/></span>


    </header>
</div>

<div id="navbar-wrapper">
    <nav id="navbar"></nav>
</div>

<!-- Add your site or application content here -->

<div class="container" ng-controller="PlayerController" ng-hide="">
    <div class="col-md-8 col-md-offset-2 shadow-effect " id="main">
        <div class="col-md-10 col-md-offset-1">
            <div class=" page-header row">
                <h1>
                    <span class="col-xs-7">Team Selection</span>
          <span class="col-xs-5" id=" searchBoxContainer">
            <input type="text" id="searchBox" class="form-control pull-right" placeholder="search"
                   ng-model="searchText"/></span>
                </h1>
            </div>
            <div class="row">

                <div class="col-sm-5 aside">

                    <div class="container-fluid">


                        <ul class="list-group ">
                            <li class="list-group-item container-fluid selectedPlayer"
                                ng-repeat="selectedPlayer in computeSelectedPlayers()"
                                    >
                            <span class="col-xs-2 pull-left no-padding-left clickable"><i
                                        class="glyphicon glyphicon-remove pull-left"
                                        ng-click="toggleActive(selectedPlayer)"></i></span>
                            <span class="col-xs-9 no-padding-left no-padding-right">{{$index + 1}}.
                            {{selectedPlayer.Name}}</span>
                            </li>
                        </ul>

                        <p>{{alertMessage}}</p>

                        <p><strong>Remaining Amount: </strong><span>{{remaining() | number}}</span></p>


                        <form name="playersForm" method="post"
                              action="/home/getsquad">
                            <input type="hidden" value="<%= csrfToken %>" name="_csrf" />
                            <input type="hidden" ng-repeat="selectedPlayer in computeSelectedPlayers()"
                                   id="{{'t'+($index+1)}}" name="{{'p'+($index+1)}}" value="{{selectedPlayer._id}}"/>


                            <input type="submit" class="btn btn-primary" ng-class="{disabled:isNotValid()}"
                                   value="Submit"
                                   ng-disabled="isNotValid()"/>
                        </form>

                    </div>
                </div>

                <div class="col-sm-7">
                    <form>
                        <ul class="list-group media-list">


                            <div class="playerlist">

                                <li ng-repeat="player in players|filter:searchText|orderBy:'-Cost'"
                                    class="media list-group-item player"
                                    ng-click="toggleActive(player)"
                                    ng-class="{'batsmanactive':player.active, 'text-muted limit-exceeded': !canSelectMore() && !player.active}"
                                    unselectable="on">

                                    <img src="" ng-src="{{player.image}}" height="30" width="30" class="img-circle "/>

                                    <span>{{player.Name}}</span><span class="pull-right">{{player.Type}}</span>
                                </li>
                            </div>


                        </ul>


                    </form>


                </div>

            </div>
        </div>
    </div>
</div>

<footer id="footer" class="footer">
</footer>


<!-- build:js(.) scripts/vendor.js -->
<!-- bower:js -->
<script src="/bower_components/jquery/dist/jquery.js"></script>
<script src="/bower_components/angularjs/angular.js"></script>
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

<!-- endbower -->
<!-- endbuild -->

<!-- build:js({.tmp,app}) scripts/scripts.js -->
<script type="text/javascript">
    var myApp = angular.module('formApp', []);
    function PlayerController($scope) {


        $scope.players = <%- JSON.stringify(Squad)%>;

        for (var i = 0; i < $scope.players.length; ++i) {
            $scope.players[i].active = false;
            $scope.players[i].image = ("https://res.cloudinary.com/gpl/players/" + $scope.players[i].Type + "/" + $scope.players[i]._id + ".jpg");

        }


        $scope.computeSelectedPlayers = function () {
            var selectedPlayers = [];
            for (var i = 0; i < $scope.players.length; ++i)
                if ($scope.players[i].active) {
                    selectedPlayers.push($scope.players[i]);
                }
            return selectedPlayers;
        };


        $scope.searchText = "";
        $scope.toggleActive = function (s) {

            if (s.active || $scope.computeSelectedPlayers().length < 11) {
                s.active = !s.active;
            }


        };

        // Helper method for calculating the total cost


        $scope.MAX_PLAYERS = 11;
        $scope.alertMessage = "";

        $scope.canSelectMore = function () {
            return $scope.computeSelectedPlayers().length < $scope.MAX_PLAYERS;
        };

        $scope.isNotValid = function (players) {
            $scope.alertMessage = "";

            var valid = true;


            var selectedPlayers = $scope.computeSelectedPlayers();

            var remainingPlayers = $scope.MAX_PLAYERS - selectedPlayers.length;
            if (remainingPlayers > 0) {

                if (remainingPlayers == 1) {
                    $scope.alertMessage = "Please Select " + remainingPlayers + " player";
                }
                else {
                    $scope.alertMessage = "Please Select " + remainingPlayers + " players";
                }

            }


            if (remainingPlayers == 0) {
                valid = true;
            }
            else {
                valid = false;
            }
            if (valid) {
                $scope.alertMessage = "Alright ! You are good to go.";
            }
            //if(!valid){
            //  window.alert(alertMessage);
            //}


            return !valid;


        };


    }
    ;
    myApp.controller('PlayerController', ['$scope', PlayerController]);
</script>

<!-- endbuild -->
<script src="/javascript/main.js"></script>
</body>
</html>
